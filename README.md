# Predictive performance of the Kidney Failure Risk Equation using creatinine- versus cystatin C-based estimated glomerular filtration rate

Authors: Malou Magnani, Merel van Diepen, Carolien CHM Maas, Antoine Créon, Aurora Caldinelli, Heather Walker, William A Russel, Friedo W Dekker, Juan-Jesus Carrero, Edouard L Fu

0. Data extraction.R

From the SCREAM2 cohort, we extract information on laboratory results, demographics, renal replacement therapy, mortality, emigration, prescribed medications, and diagnoses from hospital care, outpatient care, and primary care visits.

2. Cohort derivation.R

This file constructs the study cohort by applying sequential inclusion and exclusion criteria. The flow chart is created as follows:
1.	Identify individuals with both cystatin C and creatinine measured on the same day.
2.	Add albuminuria data, and for each albuminuria measurement, link the nearest cystatin C/creatinine measurement.
3.	Confirm that all measurements occurred prior to the date of death.
4.	Define the baseline date as the earliest measurement of albuminuria, creatinine, or cystatin C.
5.	Restrict the cohort to individuals aged 18 years or older.
6.	Calculate eGFR using the CKD-EPI 2009 creatinine-based equation, and include only those with 10 < eGFR ≤ 60.
7.	Exclude individuals who received renal replacement therapy before baseline.

Finally, we define:
1.	If multiple albuminuria values are available on the same day, use the mean.
2.	If a patient qualifies on multiple baseline dates, randomly select one.

2. Covariate derivation.R

In this file, we define key covariates as follows:
1.	Record the date of emigration.
2.	Calculate eGFR using the five equations as defined in Functions eGFR equations.R.
3.	Define comorbidities based on primary care, outpatient, and hospital records, applying an unlimited look-back period except for cancer, which uses a one-year look-back.
4.	Retrieve medication use within the past six months.

3. Outcome derivation.R

We define outcomes for 2- and 5-year time horizons. Time-to-event is measured from baseline until the earliest of the following:
•	Renal replacement therapy (primary outcome),
•	Death (competing event),
•	End of follow-up (31 December 2021, censoring),
•	Emigration (censoring), or
•	Reaching the predefined time horizon (2 or 5 years, censoring).

5. Predictions.R

We begin by describing the data by the number of events for each outcome, and cumulative incidence rates. Next, we redefine the outcome to properly account for competing risks. Following Wolbers et al., when calculating the C-statistic, we set the time-to-event to infinity (i.e., the prediction horizon) for individuals who experience a competing event. This indicates that they will never develop the outcome of interest (kidney failure). Finally, we generate predictions using each of the five equations, implemented through the functions in Functions for analysis.R.

7. Validation.R

For each predicted probability of the outcome of interest generated by the five eGFR equations, we calculate the following performance metrics:
•	C-statistic,
•	Calibration intercept,
•	Calibration slope,
•	Observed-to-expected (O/E) ratio,
•	Brier score, and
•	Scaled Brier score.
All metrics are implemented using the functions in Functions for analysis.R.
Finally, we create calibration plots, distribution plots, risk difference plots, and reclassification plots for predictions from all five eGFR equations.

